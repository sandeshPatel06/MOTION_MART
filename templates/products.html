<div class="container">
  <h1>PHOTO FRAMES</h1>
  <div id="messageBox" class="message-box"></div>
  <div class="row">
    {% if products %}
    {% for product in products %}
    <div class="product-card">
      <img src="{{ url_for('static', filename=product.image_path) }}" alt="{{ product.name }}"
        onclick="viewProductDetails('{{ product.id }}')" />
      <h3>{{ product.name }}</h3>
      <p><strong>Price:</strong> ${{ product.price }}</p>
      <button class="btn add-to-cart" onclick="addToCart('{{ product.id }}')">
        Add to Cart
      </button>
      <button class="btn buy-now"
        onclick="buyNow('{{ product.id }}', '{{ product.name }}', '{{ product.price }}')">
        Buy Now
      </button>
      <button class="btn view-details" onclick="viewProductDetails('{{ product.id }}')">
        View Details
      </button>
    </div>
    {% endfor %}
    {% else %}
    <div class="alert" role="alert">No products available.</div>
    {% endif %}
  </div>
</div>

<script>
// Function for the Buy Now button to redirect to checkout
function buyNow(productId, productName, productPrice) {
  // Save the product details to session via AJAX
  fetch('/store_product_in_session', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      productId: productId,
      productName: productName,
      productPrice: productPrice,
    }),
  })
  .then(response => {
    if (response.ok) {
      // After saving to session, redirect to checkout page
      window.location.href = '/checkout';
    } else {
      alert('Failed to add product to cart');
    }
  });
}
</script>
